import{F as o,u as U,g as J,h as K,r as c,i as N,k as X,l as Z,j as e,I as d,R as x,C as l,S as j,m as k,e as _,f as ee,B as D,n as te,p as se,M as R}from"./index-BMrJQ5tk.js";import{u as oe,S as re}from"./useItemMessage-BIQ7PqxR.js";import{M as ae}from"./index-CCaxUOYX.js";import{D as ne}from"./index-DnheamQ_.js";const de={SV:"SALIDA POR VENTA",SM:"SALIDA POR MANTENIMIENTO"},le=Object.entries(de).map(([u,f])=>({value:u,label:f})),{Option:S}=j,pe=({visible:u,title:f,initialValues:m,onSubmit:Y,onCancel:b})=>{const[r]=o.useForm(),{t}=U(),p=oe(),[V]=J(),[E]=K(),[n,h]=c.useState(null),[q,C]=c.useState(""),[g,F]=c.useState(1),[L,i]=c.useState("");c.useEffect(()=>{u&&(m?r.setFieldsValue({...m,fechaDocumento:m.fechaDocumento?N(m.fechaDocumento,"YYYY-MM-DD"):void 0}):(r.resetFields(),r.setFieldsValue({numero:"",idOperador:"-",idDocumento:"PS",detalle:[],fechaDocumento:N(),activo:!0})))},[m,u,r]);const M=()=>{r.validateFields().then(s=>{const a={...s,fechaDocumento:s.fechaDocumento.format("YYYY-MM-DD")};Y(a)})},A=async()=>{const s=r.getFieldValue("dni");if(s)try{const a=await V({personType:"N",documentNumber:s}).unwrap();r.setFieldsValue({responsable:a.nombres+" "+a.apellidoPaterno+" "+a.apellidoMaterno}),r.setFieldsValue({idResponsable:a.id})}catch(a){console.error("No se encontrÃ³ proveedor",a)}},{data:T,isLoading:B}=X("PS"),v=T,{data:G,isLoading:Q}=Z({page:0,limit:50}),y=G,z=async()=>{i("");const s=q.trim();if(!s){i(t("modules.form.required.message",{item:t("app.movements.outputs.label.code")}));return}try{const a=await E(s).unwrap();h(a)}catch{h(null),i(t("error.data"))}},$=()=>{if(!n){i(t("modules.form.required.message",{item:t("app.movements.outputs.detail.code")}));return}if(g<1){i(t("modules.form.required.message",{item:t("app.movements.outputs.detail.quantity")}));return}const s=r.getFieldValue("detalle")||[];if(s.some(O=>O.idProducto===n.id)){i(t("modules.form.duplicate",{item:t("app.products.title.full")})),h(null);return}const P={idLinea:s.length+1,idProducto:n.id,codigo:n.codigo,descripcionExtendida:n.descripcion,marca:n.marca,modelo:n.modelo,unidad:n.unidad,cantidad:g};r.setFieldsValue({detalle:[...s,P]}),C(""),h(null),F(1)};return e.jsx(ae,{title:f,open:u,destroyOnClose:!0,onOk:M,onCancel:b,footer:[e.jsx(D,{onClick:b,children:e.jsx(R,{id:"buttons.cancel"})},"cancel"),e.jsx(D,{type:"primary",onClick:M,children:e.jsx(R,{id:"buttons.save"})},"ok")],width:900,children:e.jsxs(o,{form:r,layout:"vertical",children:[e.jsx(o.Item,{name:"numero",hidden:!0,children:e.jsx(d,{})}),e.jsx(o.Item,{name:"idOperador",hidden:!0,children:e.jsx(d,{})}),e.jsx(o.Item,{name:"idDocumento",hidden:!0,children:e.jsx(d,{})}),e.jsx(o.Item,{name:"idResponsable",style:{display:"none"},children:e.jsx(d,{type:"hidden"})}),e.jsx(o.Item,{name:"detalle",style:{display:"none"},children:e.jsx(d,{type:"hidden"})}),e.jsxs(x,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(o.Item,{label:t("app.movements.outputs.form.series"),name:"idSerie",rules:[{required:!0,message:t("modules.form.required.select",{item:t("app.movements.outputs.item.series")})}],children:e.jsx(j,{placeholder:t("modules.form.required.select",{item:t("app.movements.outputs.item.series").toLocaleLowerCase()}),loading:B,children:v==null?void 0:v.map(s=>e.jsx(S,{value:s.id,children:s.idSerie},s.id))})})}),e.jsx(l,{span:12,children:e.jsx(o.Item,{label:t("app.movements.outputs.form.documentDate"),name:"fechaDocumento",rules:[{required:!0,message:p("app.movements.outputs.item.documentDate",!0)}],children:e.jsx(ne,{style:{width:"100%"},format:"DD/MM/YYYY",placeholder:t("modules.form.required.select",{item:t("app.movements.outputs.item.documentDate").toLocaleLowerCase()})})})})]}),e.jsxs(x,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(o.Item,{label:t("app.movements.outputs.form.type"),name:"idTipoMovimiento",rules:[{required:!0,message:t("modules.form.required.select",{item:t("app.movements.outputs.item.type")})}],children:e.jsx(j,{placeholder:t("modules.form.required.select",{item:t("app.movements.outputs.item.type").toLocaleLowerCase()}),children:le.map(({value:s,label:a})=>e.jsx(S,{value:s,children:a},s))})})}),e.jsx(l,{span:12,children:e.jsx(o.Item,{label:t("app.movements.outputs.form.warehouse"),name:"idAlmacen",rules:[{required:!0,message:t("modules.form.required.select",{item:t("app.movements.outputs.item.warehouse")})}],children:e.jsx(j,{placeholder:t("modules.form.required.select",{item:t("app.movements.outputs.item.warehouse").toLocaleLowerCase()}),loading:Q,children:y==null?void 0:y.map(s=>e.jsx(S,{value:s.id,children:s.nombre},s.id))})})})]}),e.jsx(o.Item,{className:"div-fixed",label:t("app.movements.outputs.form.responsible"),required:!0,children:e.jsxs(x,{gutter:16,children:[e.jsx(l,{span:5,children:e.jsx(o.Item,{name:"dni",noStyle:!0,rules:[{required:!0,message:p("app.movements.outputs.header.dni",!0)}],children:e.jsx(d.Search,{placeholder:t("app.movements.outputs.header.dni"),enterButton:e.jsx(k,{}),onSearch:async s=>{i(""),r.setFieldsValue({dni:s}),await A()}})})}),e.jsx(l,{span:19,children:e.jsx(o.Item,{children:e.jsx(d,{className:"disabled-input",value:r.getFieldValue("responsable"),readOnly:!0})})})]})}),e.jsx(o.Item,{label:t("app.movements.outputs.form.gloss"),name:"glosa",rules:[{required:!0,message:p("app.movements.outputs.item.gloss",!0)}],children:e.jsx(d,{placeholder:p("app.movements.outputs.item.gloss")})}),e.jsx(o.Item,{label:t("app.products.form.active"),name:"activo",valuePropName:"checked",children:e.jsx(re,{defaultChecked:!0,checkedChildren:e.jsx(ee,{}),unCheckedChildren:e.jsx(_,{})})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs(x,{gutter:16,align:"middle",children:[e.jsx(l,{span:6,children:e.jsx(o.Item,{label:t("app.movements.outputs.detail.product")+":",required:!0,children:e.jsx(d.Search,{value:q,onChange:s=>{C(s.target.value),i("")},placeholder:t("app.movements.outputs.label.code"),enterButton:e.jsx(k,{}),onSearch:z})})}),e.jsx(l,{span:8,children:e.jsx(o.Item,{label:t("app.movements.outputs.detail.description"),children:e.jsx(d,{className:"disabled-input",value:(n==null?void 0:n.descripcion)||"",readOnly:!0})})}),e.jsx(l,{span:4,children:e.jsx(o.Item,{label:t("app.movements.outputs.detail.quantity"),children:e.jsx(d,{type:"number",min:1,value:g,onChange:s=>F(Number(s.target.value))})})}),e.jsx(l,{span:4,children:e.jsx(o.Item,{children:e.jsx(D,{type:"primary",icon:e.jsx(te,{}),onClick:$,children:t("app.buttons.add")})})})]}),L&&e.jsx("div",{style:{color:"red",marginTop:4},children:L})]}),e.jsx(o.Item,{noStyle:!0,shouldUpdate:!0,children:()=>{const s=r.getFieldValue("detalle"),a=w=>{const W=(r.getFieldValue("detalle")||[]).filter(I=>I.idLinea!==w).map((I,H)=>({...I,idLinea:H+1}));r.setFieldsValue({detalle:W}),i("")};return e.jsx(se,{detalle:s,onRemove:a})}})]})})};export{pe as OutputFormComponent,pe as default};
