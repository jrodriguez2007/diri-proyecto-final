import{F as r,u as J,g as K,h as X,r as u,i as k,k as Z,l as _,j as e,I as i,R as j,C as d,S as f,m as E,e as ee,f as te,B as D,n as se,D as re,M as N,o as S}from"./index-i2-gkq45.js";import{u as ne,S as oe}from"./useItemMessage-MpSnIAlg.js";import{M as ae}from"./index-BTHEJ0vI.js";import{D as ie}from"./index-WPJipTif.js";const de={IC:"INGRESO POR COMPRA",RT:"DEVOLUCIÓN POR MANTENIMIENTO"},le=Object.entries(de).map(([c,g])=>({value:c,label:g})),{Option:b}=f,he=({visible:c,title:g,initialValues:m,onSubmit:Y,onCancel:C})=>{const[n]=r.useForm(),{t}=J(),p=ne(),[V]=K(),[B]=X(),[a,h]=u.useState(null),[q,F]=u.useState(""),[x,L]=u.useState(1),[M,l]=u.useState("");u.useEffect(()=>{c&&(m?n.setFieldsValue({...m,fechaDocumento:m.fechaDocumento?k(m.fechaDocumento,"YYYY-MM-DD"):void 0}):(n.resetFields(),n.setFieldsValue({numero:"",idOperador:"+",idDocumento:"PE",detalle:[],fechaDocumento:k(),activo:!0})))},[m,c,n]);const w=()=>{n.validateFields().then(s=>{const o={...s,fechaDocumento:s.fechaDocumento.format("YYYY-MM-DD")};Y(o)})},T=async()=>{const s=n.getFieldValue("ruc");if(console.log({numero:s}),!!s)try{const o=await V({personType:"J",documentNumber:s}).unwrap();n.setFieldsValue({razonSocial:o.razonSocial}),n.setFieldsValue({idResponsable:o.id})}catch(o){console.error("No se encontró proveedor",o)}},{data:G,isLoading:Q}=Z("PE"),v=G,{data:z,isLoading:A}=_({page:0,limit:50}),y=z,$=async()=>{l("");const s=q.trim();if(!s){l(t("modules.form.required.input",{item:t("app.movements.inputs.label.code")}));return}try{const o=await B(s).unwrap();h(o)}catch{h(null),l(t("error.data"))}},U=()=>{if(S.warn("Adición de detalle"),S.debug(a.descripcion),S.debug("searchQuantity: "+x),!a){l(t("modules.form.required.input",{item:t("app.movements.inputs.detail.code")}));return}if(x<1){l(t("modules.form.required.message",{item:t("app.movements.inputs.detail.quantity")}));return}const s=n.getFieldValue("detalle")||[];if(s.some(R=>R.idProducto===a.id)){l(t("modules.form.duplicate",{item:t("app.products.title.full")})),h(null);return}const P={idLinea:s.length+1,idProducto:a.id,codigo:a.codigo,descripcionExtendida:a.descripcion,marca:a.marca,modelo:a.modelo,unidad:a.unidad,cantidad:x};n.setFieldsValue({detalle:[...s,P]}),F(""),h(null),L(1)};return e.jsx(ae,{title:g,open:c,destroyOnClose:!0,onOk:w,onCancel:C,footer:[e.jsx(D,{onClick:C,children:e.jsx(N,{id:"buttons.cancel"})},"cancel"),e.jsx(D,{type:"primary",onClick:w,children:e.jsx(N,{id:"buttons.save"})},"ok")],width:900,children:e.jsxs(r,{form:n,layout:"vertical",children:[e.jsx(r.Item,{name:"numero",hidden:!0,children:e.jsx(i,{})}),e.jsx(r.Item,{name:"idOperador",hidden:!0,children:e.jsx(i,{})}),e.jsx(r.Item,{name:"idDocumento",hidden:!0,children:e.jsx(i,{})}),e.jsx(r.Item,{name:"idResponsable",style:{display:"none"},children:e.jsx(i,{type:"hidden"})}),e.jsx(r.Item,{name:"detalle",style:{display:"none"},children:e.jsx(i,{type:"hidden"})}),e.jsxs(j,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(r.Item,{label:t("app.movements.inputs.form.series"),name:"idSerie",rules:[{required:!0,message:t("modules.form.required.select",{item:t("app.movements.inputs.item.series")})}],children:e.jsx(f,{placeholder:t("modules.form.required.select",{item:t("app.movements.inputs.item.series").toLocaleLowerCase()}),loading:Q,children:v==null?void 0:v.map(s=>e.jsx(b,{value:s.id,children:s.idSerie},s.id))})})}),e.jsx(d,{span:12,children:e.jsx(r.Item,{label:t("app.movements.inputs.form.documentDate"),name:"fechaDocumento",rules:[{required:!0,message:p("app.movements.inputs.item.documentDate",!0)}],children:e.jsx(ie,{style:{width:"100%"},format:"DD/MM/YYYY",placeholder:t("modules.form.required.select",{item:t("app.movements.inputs.item.documentDate").toLocaleLowerCase()})})})})]}),e.jsxs(j,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(r.Item,{label:t("app.movements.inputs.form.type"),name:"idTipoMovimiento",rules:[{required:!0,message:t("modules.form.required.select",{item:t("app.movements.inputs.item.type")})}],children:e.jsx(f,{placeholder:t("modules.form.required.select",{item:t("app.movements.inputs.item.type").toLocaleLowerCase()}),children:le.map(({value:s,label:o})=>e.jsx(b,{value:s,children:o},s))})})}),e.jsx(d,{span:12,children:e.jsx(r.Item,{label:t("app.movements.inputs.form.warehouse"),name:"idAlmacen",rules:[{required:!0,message:t("modules.form.required.select",{item:t("app.movements.inputs.item.warehouse")})}],children:e.jsx(f,{placeholder:t("modules.form.required.select",{item:t("app.movements.inputs.item.warehouse").toLocaleLowerCase()}),loading:A,children:y==null?void 0:y.map(s=>e.jsx(b,{value:s.id,children:s.nombre},s.id))})})})]}),e.jsx(r.Item,{className:"div-fixed",label:t("app.movements.inputs.form.supplier"),required:!0,children:e.jsxs(j,{gutter:16,children:[e.jsx(d,{span:5,children:e.jsx(r.Item,{name:"ruc",noStyle:!0,rules:[{required:!0,message:p("app.movements.inputs.header.ruc",!0)}],children:e.jsx(i.Search,{placeholder:t("app.movements.inputs.header.ruc"),enterButton:e.jsx(E,{}),onSearch:async s=>{l(""),n.setFieldsValue({ruc:s}),await T()}})})}),e.jsx(d,{span:19,children:e.jsx(r.Item,{children:e.jsx(i,{className:"disabled-input",value:n.getFieldValue("razonSocial"),readOnly:!0})})})]})}),e.jsx(r.Item,{label:t("app.movements.inputs.form.gloss"),name:"glosa",rules:[{required:!0,message:p("app.movements.inputs.item.gloss",!0)}],children:e.jsx(i,{placeholder:p("app.movements.inputs.item.gloss")})}),e.jsx(r.Item,{label:t("app.products.form.active"),name:"activo",valuePropName:"checked",children:e.jsx(oe,{defaultChecked:!0,checkedChildren:e.jsx(te,{}),unCheckedChildren:e.jsx(ee,{})})}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs(j,{gutter:16,align:"middle",children:[e.jsx(d,{span:6,children:e.jsx(r.Item,{label:t("app.movements.inputs.detail.product")+":",required:!0,children:e.jsx(i.Search,{value:q,onChange:s=>{l(""),F(s.target.value)},placeholder:t("app.movements.inputs.label.code"),enterButton:e.jsx(E,{}),onSearch:$})})}),e.jsx(d,{span:8,children:e.jsx(r.Item,{label:t("app.movements.inputs.detail.description"),children:e.jsx(i,{className:"disabled-input",value:(a==null?void 0:a.descripcion)||"",readOnly:!0})})}),e.jsx(d,{span:4,children:e.jsx(r.Item,{label:t("app.movements.inputs.detail.quantity"),children:e.jsx(i,{type:"number",min:1,value:x,onChange:s=>L(Number(s.target.value))})})}),e.jsx(d,{span:4,children:e.jsx(r.Item,{children:e.jsx(D,{type:"primary",icon:e.jsx(se,{}),onClick:U,children:t("app.buttons.add")})})})]}),M&&e.jsx("div",{style:{color:"red",marginTop:4},children:M})]}),e.jsx(r.Item,{noStyle:!0,shouldUpdate:!0,children:()=>{const s=n.getFieldValue("detalle"),o=O=>{const W=(n.getFieldValue("detalle")||[]).filter(I=>I.idLinea!==O).map((I,H)=>({...I,idLinea:H+1}));n.setFieldsValue({detalle:W}),l("")};return e.jsx(re,{"data-testid":"detail-container",detalle:s,onRemove:o})}})]})})};export{he as InputFormComponent,he as default};
